# 第1章　初识Redis 1

​	Redis作为基于键值对的NoSQL数据库，具有高性能、丰富的数据结构、持久化、高可用、分布式等特性，同时Redis本身非常稳定，已经得到业界的广泛认可和使用。掌握Redis已经逐步成为开发和运维人员的必备技能之一。

​	本书关注了Redis开发运维的方方面面，尤其对于开发运维中如何提高效率、减少可能遇到的问题进行详细分析，但本书不单单介绍怎么解决这些问题，而是通过对Redis重要原理的解析，帮组开发运维人员学会找到问题的方法，以及理解背后的原理，从而让开发运维人员不仅知其然，而且知其所以然。

​	本书涵盖内容



## 1.1　盛赞Redis 1

## 1.2　Redis特性 2

## 1.3　Redis使用场景 5

### 1.3.1　Redis可以做什么 5

### 1.3.2　Redis不可以做什么 5

## 1.4　用好Redis的建议 6

## 1.5　正确安装并启动Redis 6

### 1.5.1　安装Redis 7

### 1.5.2　配置、启动、操作、关闭Redis 8

## 1.6　Redis重大版本 11

## 1.7　本章重点回顾 14

# 第2章　API的理解和使用 15

## 2.1　预备 15

### 2.1.1　全局命令 15

### 2.1.2　数据结构和内部编码 18

### 2.1.3　单线程架构 19

## 2.2　字符串 21

### 2.2.1　命令 22

### 2.2.2　内部编码 27

### 2.2.3　典型使用场景 28

## 2.3　哈希 31

### 2.3.1　命令 32

### 2.3.2　内部编码 35

### 2.3.3　使用场景 36

## 2.4　列表 38

### 2.4.1　命令 38

### 2.4.2　内部编码 43

### 2.4.3　使用场景 44

## 2.5　集合 46

### 2.5.1　命令 46

### 2.5.2　内部编码 50

### 2.5.3　使用场景 51

## 2.6　有序集合 52

### 2.6.1　命令 53

### 2.6.2　内部编码 59

### 2.6.3　使用场景 59

## 2.7　键管理 60

### 2.7.1　单个键管理 60

### 2.7.2　遍历键 67

### 2.7.3　数据库管理 70

## 2.8　本章重点回顾 73

# 第3章　小功能大用处 74

## 3.1　慢查询分析 74

### 3.1.1　慢查询的两个配置参数 75

### 3.1.2　最佳实践 77

## 3.2　Redis Shell 78

### 3.2.1　redis-cli详解 78

### 3.2.2　redis-server详解 82

### 3.2.3　redis-benchmark详解 83

## 3.3　Pipeline 84

### 3.3.1　Pipeline概念 84

### 3.3.2　性能测试 85

### 3.3.3　原生批量命令与Pipeline对比 86

### 3.3.4　最佳实践 87

## 3.4　事务与Lua 87

### 3.4.1　事务 87

### 3.4.2　Lua用法简述 90

### 3.4.3　Redis与Lua 92

### 3.4.4　案例 94

### 3.4.5　Redis如何管理Lua脚本 96

## 3.5　Bitmaps 98

### 3.5.1　数据结构模型 98

### 3.5.2　命令 98

### 3.5.3　Bitmaps分析 101

## 3.6　HyperLogLog 102

### 3.7　发布订阅 105

### 3.7.1　命令 106

### 3.7.2　使用场景 108

## 3.8　GEO 109

## 3.9　本章重点回顾 112

# 第4章　客户端 113

## 4.1　客户端通信协议 113

## 4.2　Java客户端Jedis 117

### 4.2.1　获取Jedis 117

### 4.2.2　Jedis的基本使用方法 118

### 4.2.3　Jedis连接池的使用方法 122

### 4.2.4　Redis中Pipeline的使用方法 125

### 4.2.5　Jedis的Lua脚本 126

## 4.3　Python客户端redis-py 128

### 4.3.1　获取redis-py 128

### 4.3.2　redis-py的基本使用方法 128

### 4.3.3　redis-py中Pipeline的使用方法 130

### 4.3.4　redis-py中的Lua脚本使用方法 130

## 4.4　客户端管理 131

### 4.4.1　客户端API 132

### 4.4.2　客户端相关配置 145

### 4.4.3　客户端统计片段 145

## 4.5　客户端常见异常 146

## 4.6　客户端案例分析 149

### 4.6.1　Redis内存陡增 149

### 4.6.2　客户端周期性的超时 151

## 4.7　本章重点回顾 153

# 第5章　持久化 154

## 5.1　RDB 154

### 5.1.1　触发机制 154

### 5.1.2　流程说明 155

### 5.1.3　RDB文件的处理 156

### 5.1.4　RDB的优缺点 156

## 5.2　AOF 157

### 5.2.1　使用AOF 157

### 5.2.2　命令写入 157

### 5.2.3　文件同步 158

### 5.2.4　重写机制 159

### 5.2.5　重启加载 161

### 5.2.6　文件校验 162

## 5.3　问题定位与优化 162

### 5.3.1　fork操作 162

### 5.3.2　子进程开销监控和优化 163

### 5.3.3　AOF追加阻塞 165

## 5.4　多实例部署 166

## 5.5　本章重点回顾 167

# 第6章　复制 168

## 6.1　配置 168

### 6.1.1　建立复制 168

### 6.1.2　断开复制 170

### 6.1.3　安全性 170

### 6.1.4　只读 170

### 6.1.5　传输延迟 171

## 6.2　拓扑 171

## 6.3　原理 172

### 6.3.1　复制过程 172

### 6.3.2　数据同步 175

### 6.3.3　全量复制 178

### 6.3.4　部分复制 181

### 6.3.5　心跳 183

### 6.3.6　异步复制 184

## 6.4　开发与运维中的问题 184

### 6.4.1　读写分离 184

### 6.4.2　主从配置不一致 186

### 6.4.3　规避全量复制 186

### 6.4.4　规避复制风暴 187

## 6.5　本章重点回顾 188

# 第7章　Redis的噩梦：阻塞 189

## 7.1　发现阻塞 189

## 7.2　内在原因 191

### 7.2.1　API或数据结构使用不合理 191

### 7.2.2　CPU饱和 193

### 7.2.3　持久化阻塞 194

## 7.3　外在原因 195

### 7.3.1　CPU竞争 195

### 7.3.2　内存交换 195

### 7.3.3　网络问题 196

## 7.4　本章重点回顾 199

# 第8章　理解内存 200

## 8.1　内存消耗 200

### 8.1.1　内存使用统计 200

### 8.1.2　内存消耗划分 201

### 8.1.3　子进程内存消耗 203

## 8.2　内存管理 204

### 8.2.1　设置内存上限 204

### 8.2.2　动态调整内存上限 204

### 8.2.3　内存回收策略 205

## 8.3　内存优化 209

### 8.3.1　redisObject对象 209

### 8.3.2　缩减键值对象 210

### 8.3.3　共享对象池 211

### 8.3.4　字符串优化 213

### 8.3.5　编码优化 216

### 8.3.6　控制键的数量 223

## 8.4　本章重点回顾 225

# 第9章　哨兵 226

## 9.1　基本概念 226

### 9.1.1　主从复制的问题 227

### 9.1.2　高可用 227

### 9.1.3　Redis Sentinel的高可用性 229

## 9.2　安装和部署 232

### 9.2.1　部署拓扑结构 232

### 9.2.2　部署Redis数据节点 233

### 9.2.3　部署Sentinel节点 234

### 9.2.4　配置优化 236

### 9.2.5　部署技巧 243

## 9.3　API